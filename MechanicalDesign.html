<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Tech Tree</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            overflow: auto;
            height: 100vh;
        }
        .container {
            display: flex;
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }
        #info-panel {
            width: 300px;
            background: rgba(40, 40, 40, 0.85);
            padding: 20px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
            z-index: 10;
            overflow-y: auto;
            transition: transform 0.3s ease;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        #info-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }
        #info-content {
            font-size: 14px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.3);
            margin-bottom: 15px;
        }
        #time-info {
            font-size: 14px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.3);
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        #time-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        .time-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s;
        }
        .time-button:hover {
            background: #45a049;
        }
        .time-input {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background: rgba(255, 255, 255, 0.9);
            margin-bottom: 5px;
        }
        #time-tracker {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            color: white;
        }
        #time-tracker h3 {
            margin: 0 0 5px 0;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }
        #time-tracker p {
            margin: 5px 0;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }
        #canvas {
            flex: 1;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #fff;
            overflow: auto;
            background-image: url('wp3703442-iron-man-4k-wallpapers.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        #canvas::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.3);
            z-index: 1;
            pointer-events: none;
        }
        .node, .line {
            position: relative;
            z-index: 2;
        }
        .node {
            position: absolute;
            width: 150px;
            height: 60px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 10px;
            font-weight: bold;
            color: #333;
            text-align: center;
        }
        .node.tier-1 {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        .node.tier-2 {
            background: linear-gradient(135deg, #4ECDC4, #45B7AF);
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
        }
        .node.tier-3 {
            background: linear-gradient(135deg, #A29BFE, #81ECEC);
            box-shadow: 0 4px 15px rgba(162, 155, 254, 0.4);
        }
        .node.tier-4 {
            background: linear-gradient(135deg, #74B9FF, #0984E3);
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.4);
        }
        .node.tier-5 {
            background: linear-gradient(135deg, #55EFC4, #00B894);
            box-shadow: 0 4px 15px rgba(85, 239, 196, 0.4);
        }
        .node.tier-6 {
            background: linear-gradient(135deg, #FFEAA7, #FDCB6E);
            box-shadow: 0 4px 15px rgba(255, 234, 167, 0.4);
        }
        .node.tier-7 {
            background: linear-gradient(135deg, #FAB1A0, #E17055);
            box-shadow: 0 4px 15px rgba(250, 177, 160, 0.4);
        }
        .node.tier-8 {
            background: linear-gradient(135deg, #FF7675, #D63031);
            box-shadow: 0 4px 15px rgba(255, 118, 117, 0.4);
        }
        .node.tier-9 {
            background: linear-gradient(135deg, #81ECEC, #00CEC9);
            box-shadow: 0 4px 15px rgba(129, 236, 236, 0.4);
        }
        .node.tier-10 {
            background: linear-gradient(135deg, #A8E6CF, #1DE9B6);
            box-shadow: 0 4px 15px rgba(168, 230, 207, 0.4);
        }
        .node.tier-11 {
            background: linear-gradient(135deg, #B39DDB, #9575CD);
            box-shadow: 0 4px 15px rgba(179, 157, 219, 0.4);
        }
        .node.tier-12 {
            background: linear-gradient(135deg, #90CAF9, #42A5F5);
            box-shadow: 0 4px 15px rgba(144, 202, 249, 0.4);
        }
        .node::before {
            content: attr(data-progress) '%';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .node[data-progress]:not([data-progress="0"])::before {
            opacity: 1;
        }
        .node.tier-1:hover {
            background: linear-gradient(135deg, #FF5252, #FF7676);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }
        .node.tier-2:hover {
            background: linear-gradient(135deg, #3DBEB6, #34A8A0);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.6);
        }
        .node.tier-3:hover {
            background: linear-gradient(135deg, #34A8A0, #2B938B);
            box-shadow: 0 6px 20px rgba(69, 183, 175, 0.6);
        }
        .node.tier-4:hover {
            background: linear-gradient(135deg, #2B938B, #227E77);
            box-shadow: 0 6px 20px rgba(60, 162, 154, 0.6);
        }
        .node.clickable {
            border: 2px solid #fff;
            animation: pulse 2s infinite;
        }
        .node.clickable:hover {
            transform: scale(1.1);
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.7); }
            50% { box-shadow: 0 0 25px rgba(255, 255, 255, 0.9); }
            100% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.7); }
        }
        .line {
            position: absolute;
            transform-origin: 0 0;
            transition: all 0.3s;
            z-index: 1;
            opacity: 0.7;
            background: linear-gradient(90deg, #00FF9D, #00B8FF);
            height: 2px;
            box-shadow: 0 0 5px rgba(0, 255, 157, 0.3);
        }
        .line.highlight {
            opacity: 1;
            height: 3px !important;
            z-index: 1;
            background: linear-gradient(90deg, #00CC7E, #00FF9D);
            box-shadow: 0 0 8px rgba(0, 255, 157, 0.5);
        }
        #back-button {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s;
        }
        #back-button:hover {
            background: #45a049;
        }
        .status-indicator {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            top: 5px;
            right: 5px;
            cursor: pointer;
            z-index: 3;
            transition: all 0.3s;
        }
        .status-not-started {
            background-color: #ccc;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        .status-in-progress {
            background-color: #FFC107;
            box-shadow: 0 0 5px rgba(255, 193, 7, 0.7);
            animation: pulse-yellow 2s infinite;
        }
        .status-completed {
            background-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.7);
        }
        .status-finished {
            background-color: #9C27B0;
            box-shadow: 0 0 5px rgba(156, 39, 176, 0.7);
        }
        @keyframes pulse-yellow {
            0% { box-shadow: 0 0 5px rgba(255, 193, 7, 0.7); }
            50% { box-shadow: 0 0 10px rgba(255, 193, 7, 0.9); }
            100% { box-shadow: 0 0 5px rgba(255, 193, 7, 0.7); }
        }
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s;
            border-radius: 0 0 5px 5px;
        }
        .progress-bar.in-progress {
            background: linear-gradient(90deg, #FFC107, #FF9800);
        }
        .progress-bar.completed {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
        }
        .progress-bar.not-started {
            width: 0 !important;
        }
        .progress-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 100;
            pointer-events: none;
            white-space: nowrap;
            display: none;
        }
        .progress-summary {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 100;
        }
        .storage-controls {
            position: fixed;
            top: 10px;
            right: 20px;
            z-index: 100;
            display: flex;
            gap: 10px;
        }
        .storage-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s;
        }
        .storage-button:hover {
            background: #45a049;
        }
        #file-input {
            display: none;
        }
    </style>
</head>
<body>
    <button id="back-button" onclick="window.location.href='index.html'">← Back to Main Tree</button>
    <div class="storage-controls">
        <button id="export-button" class="storage-button">Export Progress</button>
        <label for="file-input" class="storage-button">Import Progress</label>
        <input type="file" id="file-input" accept=".json">
    </div>
    <div class="container">
        <div id="info-panel">
            <div id="info-title">Algebra Tech Tree Information</div>
            <div id="info-content">Hover over a node to see detailed information about that technology.</div>
            <div style="flex-grow: 1;"></div>
            <div id="time-info">
                <div>Estimated Time: <span id="estimated-time">-</span> Hours</div>
                <div>Time Spent: <span id="time-spent">0 hrs</span></div>
                <div id="time-controls">
                    <input type="number" id="hours-input" class="time-input" placeholder="Enter hours" min="0" step="0.5">
                    <button id="add-time" class="time-button">Add Time</button>
                    <button id="reset-time" class="time-button">Reset Time</button>
                    <button id="start-timer" class="time-button">Start Timer</button>
                    <div id="active-timer" style="display: none;">
                        <div>Active Timer: <span id="timer-display">00:00:00</span></div>
                        <button id="stop-timer" class="time-button">Stop Timer</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="canvas"></div>
    </div>

    <script>
        // Load saved progress from localStorage
        let nodeProgress = {};
        
        function loadProgress() {
            const savedProgress = localStorage.getItem('algebraProgress');
            if (savedProgress) {
                nodeProgress = JSON.parse(savedProgress);
            }
        }
        
        function saveProgress() {
            localStorage.setItem('algebraProgress', JSON.stringify(nodeProgress));
            
            // Calculate and save progress for the main page
            const totalNodes = Object.keys(nodeProgress).length;
            const finishedNodes = Object.values(nodeProgress).filter(status => status === 'finished').length;
            const inProgressNodes = Object.values(nodeProgress).filter(status => status === 'in-progress').length;
            const progressPercentage = (finishedNodes / totalNodes) * 100;
            
            // Save progress to localStorage for the main page
            localStorage.setItem('algebraMainProgress', progressPercentage.toString());
        }
        
        function updateNodeStatus(nodeId, status) {
            // Save to nodeProgress object
            nodeProgress[nodeId] = status;
            
            // Save to localStorage with the correct key format
            localStorage.setItem(`algebra_${nodeId}_progress`, status);
            
            // Update visual indicators
            const node = document.getElementById(nodeId);
            if (node) {
                const indicator = node.querySelector('.status-indicator');
                const progressBar = node.querySelector('.progress-bar');
                const tooltip = node.querySelector('.progress-tooltip');
                
                // Remove all status classes
                indicator.classList.remove('status-not-started', 'status-in-progress', 'status-finished');
                progressBar.classList.remove('not-started', 'in-progress', 'finished');
                
                // Add new status class
                indicator.classList.add(`status-${status}`);
                progressBar.classList.add(status);
                
                // Set progress bar width based on status
                if (status === 'in-progress') {
                    progressBar.style.width = '50%';
                } else if (status === 'finished') {
                    progressBar.style.width = '100%';
                } else {
                    progressBar.style.width = '0%';
                }

                // Update tooltip if it exists
                if (tooltip) {
                    tooltip.textContent = `Status: ${status.replace('-', ' ')}`;
                }
            }
            
            // Check if any algebra nodes are in progress or finished
            const algebraNodes = Object.keys(localStorage)
                .filter(key => key.startsWith('algebra_') && key.endsWith('_progress'))
                .map(key => localStorage.getItem(key));
            
            const hasProgress = algebraNodes.some(nodeStatus => 
                nodeStatus === 'in-progress' || nodeStatus === 'finished'
            );
            
            // Update the parent node status in the main page
            if (hasProgress) {
                localStorage.setItem('algebra_progress', 'in-progress');
            } else {
                localStorage.setItem('algebra_progress', 'not-started');
            }
            
            // Save overall progress
            saveProgress();
        }
        
        function getNodeStatus(nodeId) {
            // First check if we have a saved status in localStorage
            const savedStatus = localStorage.getItem(`algebra_${nodeId}_progress`);
            if (savedStatus) {
                return savedStatus;
            }
            
            // If no saved status, check if the node has prerequisites
            const node = nodes.find(n => n.id === nodeId);
            if (node && node.prerequisites && node.prerequisites.length > 0) {
                // If it has prerequisites, it starts as not-started
                return 'not-started';
            }
            
            // Default to not-started
            return 'not-started';
        }
        
        function updateProgressSummary() {
            const totalNodes = Object.keys(nodeProgress).length;
            const finishedNodes = Object.values(nodeProgress).filter(status => status === 'finished').length;
            const inProgressNodes = Object.values(nodeProgress).filter(status => status === 'in-progress').length;
            const notStartedNodes = Object.values(nodeProgress).filter(status => status === 'not-started').length;
            
            const progressSummary = document.getElementById('progress-summary');
            if (progressSummary) {
                progressSummary.innerHTML = `
                    <div>Total Nodes: ${totalNodes}</div>
                    <div>Finished: ${finishedNodes}</div>
                    <div>In Progress: ${inProgressNodes}</div>
                    <div>Not Started: ${notStartedNodes}</div>
                    <div>Overall Progress: ${Math.round((finishedNodes / totalNodes) * 100)}%</div>
                `;
            }
        }
        
        // Load progress when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            
            // Create progress summary element
            const progressSummary = document.createElement('div');
            progressSummary.id = 'progress-summary';
            progressSummary.className = 'progress-summary';
            document.body.appendChild(progressSummary);
            
            // Update progress summary
            updateProgressSummary();

            // Initialize time tracking
            let totalTime = parseInt(localStorage.getItem('algebraTotalTime') || '0');
            let sessionStartTime = Date.now();
            let lastUpdateTime = sessionStartTime;

            // Update time displays
            function updateTimeDisplays() {
                const currentTime = Date.now();
                const sessionTime = Math.floor((currentTime - sessionStartTime) / 60000);
                document.getElementById('total-time').textContent = totalTime;
                document.getElementById('session-time').textContent = sessionTime;
            }

            // Update time every minute
            setInterval(() => {
                const currentTime = Date.now();
                const minutesSinceLastUpdate = Math.floor((currentTime - lastUpdateTime) / 60000);
                
                if (minutesSinceLastUpdate > 0) {
                    totalTime += minutesSinceLastUpdate;
                    localStorage.setItem('algebraTotalTime', totalTime.toString());
                    lastUpdateTime = currentTime;
                    updateTimeDisplays();
                }
            }, 60000);

            // Initial time display update
            updateTimeDisplays();
        });

        const nodes = [
    // Parent Node: Mechanical Design (Tier 1 - Root)
    { id: "mechanical_design", x: 500, y: 50, title: "Mechanical Design", tooltip: "Embark on a quest to master Mechanical Design, the foundation of robotics structures! This tree equips you to design drone frames, create spiderbot legs, and optimize Artemis’ chassis. You’ll journey from basic CAD to advanced robotics design. Prereqs: Physics (mechanics basics), Algebra (basic math). Unlocks: Fundamentals of Mechanical Design, CAD and Modeling, Mechanics of Materials, Mechanism Design, Advanced Mechanical Design. Projects: Drone (frame design), Spiderbot (leg design), Artemis (chassis optimization). Suggested resource: ‘Introduction to Mechanical Engineering Design’ on Coursera.", prereqs: ["physics", "algebra"], unlocks: ["fundamentals_mechanical_design", "cad_modeling", "mechanics_materials", "mechanism_design", "advanced_mechanical_design"], time: { estimated: "50-70 hrs", spent: "0 hrs" }, class: "tier-1", badge: "Mechanical Design Novice (Complete this node to unlock!)" },

    // Main Branches (Tier 2)
    { id: "fundamentals_mechanical_design", x: 350, y: 150, title: "Fundamentals of Mechanical Design", tooltip: "Begin your mechanical design journey with the basics! Learn engineering drawing and tolerances to sketch a drone propeller mount (e.g., specify a tolerance of ±0.1 mm). This node introduces core design principles. Prereqs: Mechanical Design (root node). Unlocks: Engineering Drawing, Design Principles. Projects: Drone (propeller mount), Spiderbot (basic sketches). Suggested resource: ‘Engineering Design Basics’ on edX.", prereqs: ["mechanical_design"], unlocks: ["engineering_drawing", "design_principles"], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-2" },

    { id: "cad_modeling", x: 450, y: 150, title: "CAD and Modeling", tooltip: "Dive into CAD and modeling to create robotics parts! Use 2D CAD to draft a spiderbot leg blueprint or 3D CAD to model a drone frame. This node introduces computer-aided design tools. Prereqs: Mechanical Design (root node). Unlocks: 2D CAD, 3D Modeling. Projects: Spiderbot (leg blueprint), Drone (frame model). Suggested resource: ‘Fusion 360 for Beginners’ on Udemy.", prereqs: ["mechanical_design"], unlocks: ["2d_cad", "3d_modeling"], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-2" },

    { id: "mechanics_materials", x: 550, y: 150, title: "Mechanics of Materials", tooltip: "Master mechanics of materials to ensure robotics durability! Analyze stress in a drone arm (e.g., σ = F/A) or select materials for Artemis’ chassis. This node covers material properties and stress analysis. Prereqs: Mechanical Design (root node). Unlocks: Material Selection, Stress and Strain. Projects: Drone (arm stress), Artemis (chassis materials). Suggested resource: ‘Mechanics of Materials’ on Khan Academy.", prereqs: ["mechanical_design"], unlocks: ["material_selection", "stress_strain"], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-2" },

    { id: "mechanism_design", x: 650, y: 150, title: "Mechanism Design", tooltip: "Explore mechanism design to create moving robotics parts! Design a linkage system for spiderbot legs or a gear system for drone motor transmission. This node introduces mechanical mechanisms. Prereqs: Mechanical Design (root node). Unlocks: Kinematics of Mechanisms, Dynamics of Mechanisms. Projects: Spiderbot (leg linkage), Drone (gear system). Suggested resource: ‘Mechanism Design Basics’ on edX.", prereqs: ["mechanical_design"], unlocks: ["kinematics_mechanisms", "dynamics_mechanisms"], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-2" },

    { id: "advanced_mechanical_design", x: 750, y: 150, title: "Advanced Mechanical Design", tooltip: "Step into advanced mechanical design for cutting-edge robotics! Learn to perform finite element analysis on Artemis’ frame or design lightweight structures for military tech drones. This node introduces advanced design techniques. Prereqs: Mechanical Design (root node). Unlocks: Finite Element Analysis, Design Optimization. Projects: Artemis (frame analysis), Drone (lightweight structure). Suggested resource: ‘Advanced Mechanical Design’ on Coursera.", prereqs: ["mechanical_design"], unlocks: ["finite_element_analysis", "design_optimization"], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-2" },

    // Fundamentals of Mechanical Design Branch (Tier 3)
    { id: "engineering_drawing", x: 300, y: 250, title: "Engineering Drawing", tooltip: "Master engineering drawing to communicate your robotics designs! Create an orthographic view of a drone motor mount or an isometric view of a spiderbot joint. This node covers technical drawing standards. Prereqs: Fundamentals of Mechanical Design (design basics). Unlocks: Tolerances and Fits. Projects: Drone (motor mount drawing), Spiderbot (joint view).", prereqs: ["fundamentals_mechanical_design"], unlocks: ["tolerances_fits"], time: { estimated: "4-6 hrs", spent: "0 hrs" }, class: "tier-3" },

    { id: "design_principles", x: 400, y: 250, title: "Design Principles", tooltip: "Apply design principles to create functional robotics parts! Use the principle of modularity to design a detachable drone arm or ensure accessibility in Artemis’ chassis design. This node covers key design concepts. Prereqs: Fundamentals of Mechanical Design (design basics). Unlocks: Design for Manufacturing. Projects: Drone (detachable arm), Artemis (chassis accessibility).", prereqs: ["fundamentals_mechanical_design"], unlocks: ["design_for_manufacturing"], time: { estimated: "4-6 hrs", spent: "0 hrs" }, class: "tier-3" },

    // CAD and Modeling Branch (Tier 3)
    { id: "2d_cad", x: 450, y: 250, title: "2D CAD", tooltip: "Use 2D CAD to draft precise robotics blueprints! Create a 2D drawing of a spiderbot leg in AutoCAD (e.g., specify dimensions for a 50 mm length) or a drone base plate. This node covers 2D CAD techniques. Prereqs: CAD and Modeling (CAD basics). Unlocks: Parametric Modeling. Projects: Spiderbot (leg drawing), Drone (base plate). Suggested resource: ‘AutoCAD for Beginners’ on Udemy.", prereqs: ["cad_modeling"], unlocks: ["parametric_modeling"], time: { estimated: "5-7 hrs", spent: "0 hrs" }, class: "tier-3" },

    { id: "3d_modeling", x: 500, y: 250, title: "3D Modeling", tooltip: "Create 3D models for robotics parts! Model a drone frame in Fusion 360 (e.g., extrude a 5 mm thick shell) or an Artemis motor housing. This node covers 3D modeling techniques. Prereqs: CAD and Modeling (CAD basics). Unlocks: Assembly Modeling. Projects: Drone (frame model), Artemis (motor housing). Suggested resource: ‘Fusion 360 3D Modeling’ on Udemy.", prereqs: ["cad_modeling"], unlocks: ["assembly_modeling"], time: { estimated: "5-7 hrs", spent: "0 hrs" }, class: "tier-3" },

    // Mechanics of Materials Branch (Tier 3)
    { id: "material_selection", x: 550, y: 250, title: "Material Selection", tooltip: "Select the right materials for your robotics projects! Choose aluminum for a drone frame (e.g., high strength-to-weight ratio) or carbon fiber for Artemis’ chassis. This node covers material properties and selection criteria. Prereqs: Mechanics of Materials (materials basics). Unlocks: Material Applications in Robotics. Projects: Drone (frame material), Artemis (chassis material).", prereqs: ["mechanics_materials"], unlocks: ["material_applications_robotics"], time: { estimated: "4-6 hrs", spent: "0 hrs" }, class: "tier-3" },

    { id: "stress_strain", x: 600, y: 250, title: "Stress and Strain", tooltip: "Analyze stress and strain to ensure robotics part durability! Calculate the stress on a spiderbot leg (e.g., σ = 500 N / 10 mm² = 50 MPa) or strain in a drone arm under load. This node covers stress-strain relationships. Prereqs: Mechanics of Materials (materials basics). Unlocks: Failure Analysis. Projects: Spiderbot (leg stress), Drone (arm strain).", prereqs: ["mechanics_materials"], unlocks: ["failure_analysis"], time: { estimated: "5-7 hrs", spent: "0 hrs" }, class: "tier-3" },

    // Mechanism Design Branch (Tier 3)
    { id: "kinematics_mechanisms", x: 650, y: 250, title: "Kinematics of Mechanisms", tooltip: "Design mechanisms with kinematics for smooth robotics motion! Analyze the velocity of a spiderbot leg linkage (e.g., v = ωr) or a drone rotor assembly. This node covers kinematic analysis of mechanisms. Prereqs: Mechanism Design (mechanism basics). Unlocks: Mechanism Synthesis. Projects: Spiderbot (leg linkage), Drone (rotor assembly).", prereqs: ["mechanism_design"], unlocks: ["mechanism_synthesis"], time: { estimated: "5-7 hrs", spent: "0 hrs" }, class: "tier-3" },

    { id: "dynamics_mechanisms", x: 700, y: 250, title: "Dynamics of Mechanisms", tooltip: "Master dynamics for mechanism design in robotics! Calculate the torque on a drone gear system (e.g., τ = F × r) or the forces in a spiderbot walking mechanism. This node covers dynamic analysis of mechanisms. Prereqs: Mechanism Design (mechanism basics). Unlocks: Mechanism Synthesis. Projects: Drone (gear torque), Spiderbot (walking forces).", prereqs: ["mechanism_design"], unlocks: ["mechanism_synthesis"], time: { estimated: "5-7 hrs", spent: "0 hrs" }, class: "tier-3" },

    // Advanced Mechanical Design Branch (Tier 3)
    { id: "finite_element_analysis", x: 750, y: 250, title: "Finite Element Analysis", tooltip: "Use finite element analysis (FEA) to optimize robotics designs! Simulate stress on Artemis’ chassis in ANSYS (e.g., max stress = 100 MPa) or a drone frame under load. This node introduces FEA techniques. Prereqs: Advanced Mechanical Design (advanced basics). Unlocks: Dynamic Simulation. Projects: Artemis (chassis stress), Drone (frame simulation). Suggested resource: ‘FEA with ANSYS’ on Udemy.", prereqs: ["advanced_mechanical_design"], unlocks: ["dynamic_simulation"], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-3" },

    { id: "design_optimization", x: 800, y: 250, title: "Design Optimization", tooltip: "Optimize your robotics designs for performance! Minimize the weight of a military tech drone frame (e.g., reduce mass by 10%) or improve Artemis’ chassis strength. This node covers optimization techniques. Prereqs: Advanced Mechanical Design (advanced basics). Unlocks: Robotics Mechanism Design. Projects: Drone (weight reduction), Artemis (chassis strength).", prereqs: ["advanced_mechanical_design"], unlocks: ["robotics_mechanism_design"], time: { estimated: "5-7 hrs", spent: "0 hrs" }, class: "tier-3" },

    // Fundamentals of Mechanical Design Branch (Tier 4)
    { id: "tolerances_fits", x: 300, y: 350, title: "Tolerances and Fits", tooltip: "Master tolerances and fits for precise robotics assembly! Specify a clearance fit for a drone motor shaft (e.g., +0.05 mm tolerance) or a press fit for spiderbot joints. This node covers tolerancing standards. Prereqs: Engineering Drawing (drawing basics). Unlocks: Practical Mechanical Design. Projects: Drone (motor shaft), Spiderbot (joint fit).", prereqs: ["engineering_drawing"], unlocks: ["practical_mechanical_design"], time: { estimated: "4-6 hrs", spent: "0 hrs" }, class: "tier-4" },

    { id: "design_for_manufacturing", x: 400, y: 350, title: "Design for Manufacturing", tooltip: "Design robotics parts for efficient manufacturing! Optimize a drone frame for 3D printing (e.g., minimize support material) or Artemis’ chassis for CNC machining. This node covers DFM principles. Prereqs: Design Principles (design basics). Unlocks: Practical Mechanical Design. Projects: Drone (3D printed frame), Artemis (CNC chassis). Suggested resource: ‘Design for Manufacturing’ on Coursera.", prereqs: ["design_principles"], unlocks: ["practical_mechanical_design"], time: { estimated: "4-6 hrs", spent: "0 hrs" }, class: "tier-4" },

    // CAD and Modeling Branch (Tier 4)
    { id: "parametric_modeling", x: 450, y: 350, title: "Parametric Modeling", tooltip: "Use parametric modeling to create flexible robotics designs! Adjust a spiderbot leg length in Fusion 360 (e.g., set parameter length = 60 mm) or a drone arm angle. This node covers parametric CAD techniques. Prereqs: 2D CAD (CAD basics). Unlocks: CAD for Robotics. Projects: Spiderbot (leg adjustment), Drone (arm angle).", prereqs: ["2d_cad"], unlocks: ["cad_for_robotics"], time: { estimated: "5-7 hrs", spent: "0 hrs" }, class: "tier-4" },

    { id: "assembly_modeling", x: 500, y: 350, title: "Assembly Modeling", tooltip: "Create assemblies for robotics systems! Model a drone rotor assembly in SolidWorks (e.g., align rotor with motor shaft) or an Artemis arm assembly. This node covers assembly modeling techniques. Prereqs: 3D Modeling (3D basics). Unlocks: CAD for Robotics. Projects: Drone (rotor assembly), Artemis (arm assembly).", prereqs: ["3d_modeling"], unlocks: ["cad_for_robotics"], time: { estimated: "5-7 hrs", spent: "0 hrs" }, class: "tier-4" },

    // Mechanics of Materials Branch (Tier 4)
    { id: "material_applications_robotics", x: 550, y: 350, title: "Material Applications in Robotics", tooltip: "Apply materials knowledge to robotics designs! Use composites for a lightweight drone frame (e.g., carbon fiber for 50% weight reduction) or titanium for spiderbot joints. This node applies material selection to robotics. Prereqs: Material Selection (material basics). Unlocks: Advanced Material Analysis. Projects: Drone (composite frame), Spiderbot (titanium joints).", prereqs: ["material_selection"], unlocks: ["advanced_material_analysis"], time: { estimated: "5-7 hrs", spent: "0 hrs" }, class: "tier-4" },

    { id: "failure_analysis", x: 600, y: 350, title: "Failure Analysis", tooltip: "Perform failure analysis to ensure robotics reliability! Analyze fatigue failure in a drone propeller (e.g., stress cycles > 10^6) or crack propagation in Artemis’ chassis. This node covers failure modes and analysis. Prereqs: Stress and Strain (stress basics). Unlocks: Advanced Material Analysis. Projects: Drone (propeller fatigue), Artemis (chassis cracks). Suggested resource: ‘Failure Analysis’ on edX.", prereqs: ["stress_strain"], unlocks: ["advanced_material_analysis"], time: { estimated: "5-7 hrs", spent: "0 hrs" }, class: "tier-4" },

    // Mechanism Design Branch (Tier 4)
    { id: "mechanism_synthesis", x: 675, y: 350, title: "Mechanism Synthesis", tooltip: "Synthesize mechanisms for precise robotics motion! Design a four-bar linkage for spiderbot walking (e.g., optimize for 30° swing) or a cam system for drone payload release. This node covers mechanism synthesis techniques. Prereqs: Kinematics of Mechanisms, Dynamics of Mechanisms (mechanism basics). Unlocks: Robotics Mechanism Design. Projects: Spiderbot (walking linkage), Drone (payload release).", prereqs: ["kinematics_mechanisms", "dynamics_mechanisms"], unlocks: ["robotics_mechanism_design"], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-4" },

    // Advanced Mechanical Design Branch (Tier 4)
    { id: "dynamic_simulation", x: 750, y: 350, title: "Dynamic Simulation", tooltip: "Simulate dynamic behavior for robotics designs! Simulate a spiderbot leg motion in MATLAB (e.g., calculate angular velocity) or a drone frame under vibration. This node covers dynamic simulation techniques. Prereqs: Finite Element Analysis (FEA basics). Unlocks: Robotics Mechanism Design. Projects: Spiderbot (leg motion), Drone (vibration analysis).", prereqs: ["finite_element_analysis"], unlocks: ["robotics_mechanism_design"], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-4" },

    // Fundamentals of Mechanical Design Branch (Tier 5)
    { id: "practical_mechanical_design", x: 350, y: 450, title: "Practical Mechanical Design", tooltip: "Apply mechanical design practically in robotics projects! Prototype a drone frame using 3D printing or assemble a spiderbot leg mechanism with proper tolerances. This node focuses on hands-on design skills. Prereqs: Tolerances and Fits, Design for Manufacturing (fundamentals skills). Unlocks: None. Projects: Drone (3D printed frame), Spiderbot (leg assembly). Suggested resource: ‘Practical Mechanical Design’ book.", prereqs: ["tolerances_fits", "design_for_manufacturing"], unlocks: [], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-5", badge: "Design Practitioner (Complete the Fundamentals of Mechanical Design branch to unlock!)" },

    // CAD and Modeling Branch (Tier 5)
    { id: "cad_for_robotics", x: 475, y: 450, title: "CAD for Robotics", tooltip: "Master CAD for robotics applications! Design a fully assembled drone with moving parts in Fusion 360 (e.g., rotor motion simulation) or an Artemis chassis with integrated components. This node applies CAD to robotics. Prereqs: Parametric Modeling, Assembly Modeling (CAD skills). Unlocks: None. Projects: Drone (full assembly), Artemis (integrated chassis). Suggested resource: ‘Advanced CAD for Robotics’ on Udemy.", prereqs: ["parametric_modeling", "assembly_modeling"], unlocks: [], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-5", badge: "CAD Specialist (Complete the CAD and Modeling branch to unlock!)" },

    // Mechanics of Materials Branch (Tier 5)
    { id: "advanced_material_analysis", x: 575, y: 450, title: "Advanced Material Analysis", tooltip: "Perform advanced material analysis for robotics durability! Analyze thermal expansion in a drone frame (e.g., ΔL = αLΔT) or fatigue life of Artemis’ chassis under cyclic loads. This node covers advanced material analysis. Prereqs: Material Applications in Robotics, Failure Analysis (material skills). Unlocks: None. Projects: Drone (thermal expansion), Artemis (fatigue life).", prereqs: ["material_applications_robotics", "failure_analysis"], unlocks: [], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-5", badge: "Materials Engineer (Complete the Mechanics of Materials branch to unlock!)" },

    // Mechanism Design and Advanced Mechanical Design Branch (Tier 5)
    { id: "robotics_mechanism_design", x: 700, y: 450, title: "Robotics Mechanism Design", tooltip: "Design advanced mechanisms for robotics systems! Create a compliant mechanism for a military tech drone’s wing flap or a multi-DOF system for spiderbot locomotion. This node applies mechanism design to robotics. Prereqs: Mechanism Synthesis, Dynamic Simulation, Design Optimization (mechanism and advanced skills). Unlocks: None. Projects: Drone (wing flap), Spiderbot (multi-DOF locomotion). Suggested resource: ‘Robotics Mechanism Design’ on Coursera.", prereqs: ["mechanism_synthesis", "dynamic_simulation", "design_optimization"], unlocks: [], time: { estimated: "6-8 hrs", spent: "0 hrs" }, class: "tier-5", badge: "Mechanism Designer (Complete the Mechanism Design and Advanced Mechanical Design branches to unlock!)" }
];
        const canvas = document.getElementById("canvas");
        const infoTitle = document.getElementById("info-title");
        const infoContent = document.getElementById("info-content");
        const infoPanel = document.getElementById("info-panel");

        // Add collision detection and resolution
        function checkCollision(node1, node2) {
            const padding = 20; // Minimum space between nodes
            return !(node1.x + 140 + padding < node2.x || 
                    node1.x > node2.x + 140 + padding || 
                    node1.y + 40 + padding < node2.y || 
                    node1.y > node2.y + 40 + padding);
        }

        function resolveCollisions() {
            let hasCollision = true;
            let iterations = 0;
            const maxIterations = 100; // Prevent infinite loops
            
            while (hasCollision && iterations < maxIterations) {
                hasCollision = false;
                iterations++;
                
                for (let i = 0; i < nodes.length; i++) {
                    for (let j = i + 1; j < nodes.length; j++) {
                        if (checkCollision(nodes[i], nodes[j])) {
                            hasCollision = true;
                            
                            // Calculate the direction to move nodes apart
                            const dx = nodes[j].x - nodes[i].x;
                            const dy = nodes[j].y - nodes[i].y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance === 0) {
                                // If nodes are exactly on top of each other, move them apart randomly
                                nodes[i].x -= 50;
                                nodes[j].x += 50;
                            } else {
                                // Move nodes apart along their center line
                                const moveX = (dx / distance) * 25;
                                const moveY = (dy / distance) * 25;
                                
                                nodes[i].x -= moveX;
                                nodes[i].y -= moveY;
                                nodes[j].x += moveX;
                                nodes[j].y += moveY;
                            }
                        }
                    }
                }
            }
        }

        // Function to increase spacing between nodes
        function increaseSpacing(horizontalFactor = 2.0, verticalFactor = 2.0) {
            // Add offset to move everything right of info panel
            const infoPanelOffset = 450; // Increased from 400 to 450 for more space
            
            // Find the minimum x and y to maintain relative positioning
            const minX = Math.min(...nodes.map(node => node.x));
            const minY = Math.min(...nodes.map(node => node.y));
            
            // Apply spacing to each node
            nodes.forEach(node => {
                // Calculate new position relative to minimum values
                const relativeX = node.x - minX;
                const relativeY = node.y - minY;
                
                // Apply spacing factors and restore offset with additional right shift
                node.x = minX + (relativeX * horizontalFactor) + infoPanelOffset;
                node.y = minY + (relativeY * verticalFactor);
                
                // Ensure no node is positioned behind the sidebar
                if (node.x < 350) { // 300px sidebar width + 50px buffer
                    node.x = 350;
                }
            });

            // Resolve any collisions after spacing
            resolveCollisions();
        }

        // Apply increased spacing and resolve collisions
        increaseSpacing(2.2, 2.0);

        // Draw lines between nodes
        function drawLines() {
            nodes.forEach(node => {
                node.unlocks.forEach(unlockId => {
                    const target = nodes.find(n => n.id === unlockId);
                    if (target) {
                        const line = document.createElement("div");
                        const dx = target.x + 70 - (node.x + 70);
                        const dy = target.y - node.y;
                        const length = Math.sqrt(dx * dx + dy * dy);
                        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                        line.className = "line";
                        line.setAttribute("data-from", node.id);
                        line.setAttribute("data-to", target.id);
                        line.style.width = `${length}px`;
                        line.style.left = `${node.x + 70}px`;
                        line.style.top = `${node.y + 20}px`;
                        line.style.transform = `rotate(${angle}deg)`;
                        canvas.appendChild(line);
                    }
                });
            });
        }

        // Create nodes
        nodes.forEach(node => {
            const div = document.createElement('div');
            div.className = 'node';
            div.id = node.id;
            div.style.left = `${node.x}px`;
            div.style.top = `${node.y}px`;
            div.innerHTML = node.title;
            
            // Add tier class based on y position
            const tier = Math.floor((node.y - 50) / 200) + 1;
            div.classList.add(`tier-${tier}`);
            
            // Add status indicator
            const indicator = document.createElement('div');
            indicator.className = 'status-indicator';
            const status = getNodeStatus(node.id);
            indicator.classList.add(`status-${status}`);
            
            // Add progress bar
            const progressBar = document.createElement('div');
            progressBar.className = 'progress-bar';
            progressBar.classList.add(status);
            
            // Set progress bar width based on status
            if (status === 'in-progress') {
                progressBar.style.width = '50%';
            } else if (status === 'finished') {
                progressBar.style.width = '100%';
            } else {
                progressBar.style.width = '0%';
            }
            
            // Add progress tooltip
            const tooltip = document.createElement('div');
            tooltip.className = 'progress-tooltip';
            tooltip.textContent = `Status: ${status.replace('-', ' ')}`;
            
            // Add click handler for status indicator
            indicator.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent node click event
                
                const currentStatus = getNodeStatus(node.id);
                let newStatus;
                
                // Cycle through statuses
                if (currentStatus === 'not-started') {
                    newStatus = 'in-progress';
                } else if (currentStatus === 'in-progress') {
                    newStatus = 'finished';
                } else if (currentStatus === 'finished') {
                    newStatus = 'not-started';
                }
                
                updateNodeStatus(node.id, newStatus);
                
                // Update tooltip
                tooltip.textContent = `Status: ${newStatus.replace('-', ' ')}`;
            });
            
            // Show tooltip on hover
            indicator.addEventListener('mouseenter', (e) => {
                tooltip.style.display = 'block';
                tooltip.style.left = `${e.clientX + 10}px`;
                tooltip.style.top = `${e.clientY + 10}px`;
                document.body.appendChild(tooltip);
            });
            
            indicator.addEventListener('mousemove', (e) => {
                tooltip.style.left = `${e.clientX + 10}px`;
                tooltip.style.top = `${e.clientY + 10}px`;
            });
            
            indicator.addEventListener('mouseleave', () => {
                tooltip.style.display = 'none';
                if (tooltip.parentNode) {
                    tooltip.parentNode.removeChild(tooltip);
                }
            });
            
            div.appendChild(indicator);
            div.appendChild(progressBar);

            // Add event listeners for highlighting connections
            div.addEventListener('mouseenter', () => {
                // Set selected node
                selectedNodeId = node.id;
                
                // Load saved time for this node
                loadTime();
                
                // Highlight outgoing connections
                document.querySelectorAll(`.line[data-from="${node.id}"]`).forEach(line => {
                    line.classList.add('highlight');
                });
                // Highlight incoming connections
                document.querySelectorAll(`.line[data-to="${node.id}"]`).forEach(line => {
                    line.classList.add('highlight');
                });
                
                // Update info panel
                infoTitle.textContent = node.title;
                infoContent.textContent = node.tooltip;
                
                // Update time info
                document.getElementById('estimated-time').textContent = node.time.estimated;
                document.getElementById('time-spent').textContent = formatTime(totalTimeSpent);
            });

            div.addEventListener('mouseleave', () => {
                // Clear selected node
                selectedNodeId = null;
                
                // Remove highlight from all lines
                document.querySelectorAll('.line.highlight').forEach(line => {
                    line.classList.remove('highlight');
                });
                
                // Reset info panel
                infoTitle.textContent = "Algebra Tech Tree Information";
                infoContent.textContent = "Hover over a node to see detailed information about that technology.";
                
                // Reset time info
                document.getElementById('estimated-time').textContent = "-";
                document.getElementById('time-spent').textContent = "0 hrs";
            });

            canvas.appendChild(div);
        });

        // Draw lines after creating nodes
        drawLines();

        function updateNodeProgress() {
            // Get progress for each node from nodeProgress object
            nodes.forEach(node => {
                const status = getNodeStatus(node.id);
                const nodeElement = document.getElementById(node.id);
                if (nodeElement) {
                    const indicator = nodeElement.querySelector('.status-indicator');
                    const progressBar = nodeElement.querySelector('.progress-bar');
                    
                    if (indicator && progressBar) {
                        // Remove all status classes
                        indicator.classList.remove('status-not-started', 'status-in-progress', 'status-finished');
                        progressBar.classList.remove('not-started', 'in-progress', 'finished');
                        
                        // Add current status class
                        indicator.classList.add(`status-${status}`);
                        progressBar.classList.add(status);
                        
                        // Set progress bar width based on status
                        if (status === 'in-progress') {
                            progressBar.style.width = '50%';
                        } else if (status === 'finished') {
                            progressBar.style.width = '100%';
                        } else {
                            progressBar.style.width = '0%';
                        }
                    }
                }
            });
            
            // Update progress summary
            updateProgressSummary();
        }

        // Add click handler for nodes to update progress
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            nodes.forEach(node => {
                if (Math.abs(node.x - x) < 30 && Math.abs(node.y - y) < 30) {
                    const currentStatus = getNodeStatus(node.id);
                    let newStatus;
                    
                    // Cycle through statuses
                    if (currentStatus === 'not-started') {
                        newStatus = 'in-progress';
                    } else if (currentStatus === 'in-progress') {
                        newStatus = 'finished';
                    } else if (currentStatus === 'finished') {
                        newStatus = 'not-started';
                    }
                    
                    updateNodeStatus(node.id, newStatus);
                }
            });
        });

        // Call updateNodeProgress when the page loads
        window.addEventListener('load', updateNodeProgress);
        
        // Export progress data
        document.getElementById('export-button').addEventListener('click', () => {
            // Collect all progress data
            const progressData = {
                algebraProgress: localStorage.getItem('algebraProgress') || '0',
                algebraNodes: {}
            };
            
            // Get all algebra node progress
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('algebra_') && key.endsWith('_progress')) {
                    const nodeId = key.replace('algebra_', '').replace('_progress', '');
                    progressData.algebraNodes[nodeId] = localStorage.getItem(key);
                }
            }
            
            // Create and download the file
            const dataStr = JSON.stringify(progressData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'algebra-progress.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        });
        
        // Import progress data
        document.getElementById('file-input').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const progressData = JSON.parse(e.target.result);
                    
                    // Clear existing algebra progress data
                    for (let i = localStorage.length - 1; i >= 0; i--) {
                        const key = localStorage.key(i);
                        if (key.startsWith('algebra_') && key.endsWith('_progress')) {
                            localStorage.removeItem(key);
                        }
                    }
                    
                    // Restore algebra progress data
                    if (progressData.algebraProgress) {
                        localStorage.setItem('algebraProgress', progressData.algebraProgress);
                    }
                    
                    // Restore algebra node progress
                    if (progressData.algebraNodes) {
                        Object.entries(progressData.algebraNodes).forEach(([nodeId, progress]) => {
                            localStorage.setItem(`algebra_${nodeId}_progress`, progress);
                        });
                    }
                    
                    // Update the UI
                    updateNodeProgress();
                    
                    // Show success message
                    alert('Algebra progress data imported successfully!');
                } catch (error) {
                    console.error('Error importing progress data:', error);
                    alert('Error importing progress data. Please check the file format.');
                }
            };
            reader.readAsText(file);
        });

        // Time tracking variables
        let totalTimeSpent = 0;
        let startTime = null;
        let timerInterval = null;
        let selectedNodeId = null;  // Track currently selected node

        // Format time for display
        function formatTime(hours) {
            if (hours === 0) return '0 hrs';
            const wholeHours = Math.floor(hours);
            const minutes = Math.round((hours - wholeHours) * 60);
            if (minutes === 0) return `${wholeHours} hrs`;
            return `${wholeHours} hrs ${minutes} mins`;
        }

        // Update time display
        function updateTimeDisplay() {
            if (selectedNodeId) {
                document.getElementById('time-spent').textContent = formatTime(totalTimeSpent);
            }
        }

        // Add time manually
        function addTime(hours) {
            if (!selectedNodeId) {
                alert('Please select a node first by hovering over it');
                return;
            }
            totalTimeSpent += hours;
            updateTimeDisplay();
            saveTime();
        }

        // Reset time tracking
        function resetTime() {
            if (!selectedNodeId) {
                alert('Please select a node first by hovering over it');
                return;
            }
            totalTimeSpent = 0;
            updateTimeDisplay();
            saveTime();
        }

        // Start/Stop timer
        function toggleTimer() {
            if (!selectedNodeId) {
                alert('Please select a node first by hovering over it');
                return;
            }
            
            const timerButton = document.getElementById('start-timer');
            const activeTimer = document.getElementById('active-timer');
            
            if (!startTime) {
                // Start timer
                startTime = new Date();
                timerInterval = setInterval(updateTimerDisplay, 1000);
                timerButton.textContent = 'Stop Timer';
                activeTimer.style.display = 'block';
            } else {
                // Stop timer
                const endTime = new Date();
                const elapsedHours = (endTime - startTime) / (1000 * 60 * 60);
                totalTimeSpent += elapsedHours;
                
                clearInterval(timerInterval);
                startTime = null;
                timerInterval = null;
                
                timerButton.textContent = 'Start Timer';
                activeTimer.style.display = 'none';
                document.getElementById('timer-display').textContent = '00:00:00';
                
                updateTimeDisplay();
                saveTime();
            }
        }

        // Update timer display
        function updateTimerDisplay() {
            if (!startTime) return;
            
            const currentTime = new Date();
            const elapsedMs = currentTime - startTime;
            const hours = Math.floor(elapsedMs / (1000 * 60 * 60));
            const minutes = Math.floor((elapsedMs % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((elapsedMs % (1000 * 60)) / 1000);
            
            document.getElementById('timer-display').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // Save time to localStorage
        function saveTime() {
            if (selectedNodeId) {
                localStorage.setItem(`algebra_${selectedNodeId}_total_time`, totalTimeSpent.toString());
            }
        }

        // Load time from localStorage
        function loadTime() {
            if (selectedNodeId) {
                const savedTime = localStorage.getItem(`algebra_${selectedNodeId}_total_time`);
                if (savedTime) {
                    totalTimeSpent = parseFloat(savedTime);
                } else {
                    totalTimeSpent = 0;
                }
                updateTimeDisplay();
            }
        }

        // Event listeners for time tracking
        document.getElementById('add-time').addEventListener('click', () => {
            const timeInput = document.getElementById('hours-input');
            const hours = parseFloat(timeInput.value);
            if (!isNaN(hours) && hours > 0) {
                addTime(hours);
                timeInput.value = '';
            }
        });

        document.getElementById('reset-time').addEventListener('click', () => {
            if (confirm('Are you sure you want to reset the time tracking?')) {
                resetTime();
            }
        });

        document.getElementById('start-timer').addEventListener('click', toggleTimer);

        // Initialize time tracking
        loadTime();
    </script>
</body>
</html> 